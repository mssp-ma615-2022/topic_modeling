---
title: "IMDB topic modeling"
output: pdf_document
author: "Zhi Tu, Tao Guo, Yalong Wang, Tianjian Xie"
date: "2022-11-08"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
pacman::p_load(tidyverse, tidytext, ggplot2, tm, topicmodels)
library(tidyverse)
library(tidytext)
library(ggplot2)
library(tm)
library(topicmodels)
```

## read data

```{r}
imdb <- read.csv("IMDB Dataset.csv")
```


```{r warning=FALSE}
# Dataset separating
# separate by lines 
reviews <- imdb %>% 
  mutate(review_number = row_number()) %>%
  separate(review,c("1", "2", "3", "4", "5","6"), sep="<br /><br />", convert = TRUE) %>% 
  pivot_longer(c("1", "2", "3", "4","5","6"), names_to = "lines", names_transform = list(lines = as.integer), values_to = "text") %>%
  arrange(review_number, lines) %>%
  relocate(text) %>%
  tibble()


true_sentiment <- imdb %>% select(sentiment) %>% mutate(review_number = row_number()) %>% tibble()
# separate by words
tidy_reviews <- reviews %>% unnest_tokens(word, text) 
```

```{r}
## Build tf-idf tibble 
tidy_reviews_origin <- reviews %>% unnest_tokens(word, text)%>%
  count(review_number, word, sort = TRUE)
total_words_origin <- tidy_reviews_origin %>% group_by(review_number) %>%
  summarize(total = sum(n))


reviews_words_origin <- left_join(tidy_reviews_origin, total_words_origin)
review_tf_idf_origin <- reviews_words_origin %>%
  bind_tf_idf(word, review_number, n)
review_tf_idf_origin %>%
  select(-total) %>%
  arrange(desc(tf_idf))
```

